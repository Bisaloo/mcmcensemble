<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interaction of mcmcensemble with other packages for MCMC diagnostic and plotting â€¢ mcmcensemble</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Interaction of mcmcensemble with other packages for MCMC diagnostic and plotting">
<meta property="og:description" content="mcmcensemble">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcmcensemble</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/blog/blog_v3.html">mcmcensemble 3.0.0: new way of specifying inits values</a>
    </li>
    <li>
      <a href="../articles/diagnostic-pkgs.html">Interaction of mcmcensemble with other packages for MCMC diagnostic and plotting</a>
    </li>
    <li>
      <a href="../articles/faq.html">Frequently Asked Questions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="../articles/blog_v3.html">Version 3.0.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Bisaloo/mcmcensemble/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="diagnostic-pkgs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Interaction of mcmcensemble with other packages for MCMC diagnostic and plotting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Bisaloo/mcmcensemble/blob/master/vignettes/diagnostic-pkgs.Rmd"><code>vignettes/diagnostic-pkgs.Rmd</code></a></small>
      <div class="hidden name"><code>diagnostic-pkgs.Rmd</code></div>

    </div>

    
    
<p>To keep mcmcensemble as lean as possible, all diagnostics and plotting facilities are outsourced to other packages. It makes more sense to rely on these generic packages as the tools they provide can be used by many other MCMC packages.</p>
<p>To our knowledge, there are two such packages that are readily compatible with mcmcensemble (but please <a href="https://github.com/Bisaloo/mcmcensemble/issues/new/choose">open an issue in the GitHub repository</a> if you find others):</p>
<ul>
<li>
<a href="https://cran.r-project.org/package=coda">coda</a>, a widespread package defining a common format for MCMC object and various utilities</li>
<li>
<a href="https://mc-stan.org/bayesplot/">bayesplot</a>, a more recent package developed by the <a href="https://mc-stan.org/">Stan team</a> a which offers a larger variety of plotting options based on <a href="https://ggplot2.tidyverse.org/">ggplot2</a>
</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bisaloo/mcmcensemble">mcmcensemble</a></span><span class="op">)</span>

<span class="co">## a log-pdf to sample from</span>
<span class="va">p.log</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">B</span> <span class="op">&lt;-</span> <span class="fl">0.03</span> <span class="co"># controls 'bananacity'</span>
  <span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fl">200</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">B</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">B</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span>

<span class="va">unif_inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div id="coda" class="section level2">
<h2 class="hasAnchor">
<a href="#coda" class="anchor"></a>coda</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></code></pre></div>
<p><em>Usage of the coda package to diagnostic and plot your mcmc chains require the use of the <code>coda = TRUE</code> option in your <code><a href="../reference/MCMCEnsemble.html">MCMCEnsemble()</a></code> call:</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## use stretch move, return samples as 'coda' object</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MCMCEnsemble.html">MCMCEnsemble</a></span><span class="op">(</span>
  <span class="va">p.log</span>,
  inits <span class="op">=</span> <span class="va">unif_inits</span>,
  max.iter <span class="op">=</span> <span class="fl">3000</span>, n.walkers <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"stretch"</span>, coda <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt; Using stretch move with 10 walkers.</span></code></pre></div>
<p>The estimations are stored in the <code>samples</code> element of the result. This element is of class <code>mcmc.list</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>
<span class="co">#&gt; [1] "mcmc.list"</span></code></pre></div>
<p>As such, it can use specific method from the coda package, such as <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> or <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Iterations = 1:300</span>
<span class="co">#&gt; Thinning interval = 1 </span>
<span class="co">#&gt; Number of chains = 10 </span>
<span class="co">#&gt; Sample size per chain = 300 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span>
<span class="co">#&gt;    plus standard error of the mean:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      Mean     SD Naive SE Time-series SE</span>
<span class="co">#&gt; a  1.7088 10.254  0.18720         1.1741</span>
<span class="co">#&gt; b -0.4099  4.032  0.07362         0.3533</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 2. Quantiles for each variable:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     2.5%    25%    50%   75%  97.5%</span>
<span class="co">#&gt; a -17.25 -5.973 1.1492 8.376 21.817</span>
<span class="co">#&gt; b -11.00 -1.725 0.9986 2.253  4.152</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>You can also use any other function from the coda package, such as <code><a href="https://rdrr.io/pkg/coda/man/effectiveSize.html">effectiveSize()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/coda/man/effectiveSize.html">effectiveSize</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>
<span class="co">#&gt;         a         b </span>
<span class="co">#&gt;  59.27473 113.52668</span></code></pre></div>
<p>Please report to coda documentation to see the complete list of available functions.</p>
</div>
<div id="bayesplot" class="section level2">
<h2 class="hasAnchor">
<a href="#bayesplot" class="anchor"></a>bayesplot</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/">bayesplot</a></span><span class="op">)</span>
<span class="co">#&gt; This is bayesplot version 1.8.0</span>
<span class="co">#&gt; - Online documentation and vignettes at mc-stan.org/bayesplot</span>
<span class="co">#&gt; - bayesplot theme set to bayesplot::theme_default()</span>
<span class="co">#&gt;    * Does _not_ affect other ggplot2 plots</span>
<span class="co">#&gt;    * See ?bayesplot_theme_set for details on theme setting</span></code></pre></div>
<p>As opposed to the previous example, bayesplot is readily compatible with all outputs from <code><a href="../reference/MCMCEnsemble.html">MCMCEnsemble()</a></code>, no matter the value you specified for the <code>coda</code> argument:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res_nocoda</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MCMCEnsemble.html">MCMCEnsemble</a></span><span class="op">(</span>
  <span class="va">p.log</span>,
  inits <span class="op">=</span> <span class="va">unif_inits</span>,
  max.iter <span class="op">=</span> <span class="fl">3000</span>, n.walkers <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"stretch"</span>, coda <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; Using stretch move with 10 walkers.</span>

<span class="va">res_coda</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MCMCEnsemble.html">MCMCEnsemble</a></span><span class="op">(</span>
  <span class="va">p.log</span>,
  inits <span class="op">=</span> <span class="va">unif_inits</span>,
  max.iter <span class="op">=</span> <span class="fl">3000</span>, n.walkers <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"stretch"</span>, coda <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt; Using stretch move with 10 walkers.</span></code></pre></div>
<p>We can use the various plotting facilities:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Density of log-posterior of each parameter</span>
<span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html">mcmc_areas</a></span><span class="op">(</span><span class="va">res_nocoda</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>
<span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html">mcmc_areas</a></span><span class="op">(</span><span class="va">res_coda</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html">mcmc_dens</a></span><span class="op">(</span><span class="va">res_nocoda</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>
<span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html">mcmc_dens</a></span><span class="op">(</span><span class="va">res_coda</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>

<span class="co"># All the sample points in the parameter space</span>
<span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-scatterplots.html">mcmc_scatter</a></span><span class="op">(</span><span class="va">res_nocoda</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>
<span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-scatterplots.html">mcmc_scatter</a></span><span class="op">(</span><span class="va">res_coda</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-10-1.png" width="45%"><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-10-2.png" width="45%"><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-10-3.png" width="45%"><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-10-4.png" width="45%"><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-10-5.png" width="45%"><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-10-6.png" width="45%"></p>
<p>However, a limited number of functions still only work with <code>coda = TRUE</code>. It is for example the case of <code><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">res_coda</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Because bayesplot relies on ggplot and its layer system, you can add extra layers as necessary. For example, a common request is how to display the prior and posterior density on the same plot. If your prior is wrapped in a R function, you can then use the <code><a href="https://mc-stan.org/bayesplot/reference/bayesplot-helpers.html">overlay_function()</a></code> for this. In our case, we used a uniform distribution as our prior:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html">mcmc_dens</a></span><span class="op">(</span><span class="va">res_coda</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-helpers.html">overlay_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="st">"dunif"</span>, geom <span class="op">=</span> <span class="st">"density"</span>, color <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="diagnostic-pkgs_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.normalesup.org/~hgruson/">Hugo Gruson</a>, Sanda Dejanic, Andreas Scheidegger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
